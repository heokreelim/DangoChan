<!DOCTYPE html>
<html lang="ko" xmlns:th="http://thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script lang="javascript" src="https://cdn.sheetjs.com/xlsx-0.20.3/package/dist/xlsx.full.min.js"></script>

    <script>
        $(document).ready(function () {
            let modalAddingCategory = $('.modal_adding_category');
            let modalEditingCategory = $('.modal_editing_category');
            let modalAddingMenu = $('.modal_adding_menu');
            let modalAddingDeck = $('.modal_adding_deck');
            let modalImportingDeck = $('.modal_importing_deck');


            /* ëª¨ë‹¬ ìƒí˜¸ì‘ìš© ë²„íŠ¼ */
            $('.btn-open-adding-category-modal').click(function () {
                modalAddingCategory.css("display", "flex");
            });

            $('.btn-open-editing-category-modal').click(function () {
                modalEditingCategory.css("display", "flex");
            });

            $('.btn-open-adding-menu-modal').click(function () {
                modalAddingMenu.css("display", "flex");
            });
            $('.btn-open-adding-deck-modal').click(function () {
                modalAddingDeck.css("display", "flex");
                var tableBody = $('.card_list tbody');
                tableBody.empty();
            });
            $('.btn-open-adding-card-modal').on('click', function (event) {
                modalAddingCard.css("display", "flex");
            });

            $('.btn-close-modal').click(function () {
                modalAddingCategory.css("display", "none");
                modalEditingCategory.css("display", "none");
                modalAddingMenu.css("display", "none");
                modalAddingDeck.css("display", "none");
                modalImportingDeck.css("display", "none");
                modalAddingCard.css("display", "none");
            });
        });

    </script>
    <script>
        $(document).ready(function () {
            var fileInput = $('#importFile');
            var tableBody = $('.card_list tbody');
            var modal = $('#modal_importing_deck');
            $('.btn-open-importing-deck-modal').on('click', function (event) {
                event.preventDefault();
                fileInput.click();
            });

            fileInput.on('change', function (event) {
                $('.modal_importing_deck').css("display", "flex");
                var file = event.target.files[0];
                if (file) {
                    var reader = new FileReader();
                    reader.readAsArrayBuffer(file);

                    reader.onload = function (e) {
                        var data = new Uint8Array(e.target.result);
                        var workbook = XLSX.read(data, { type: 'array' });
                        var sheetName = workbook.SheetNames[0];
                        var sheet = workbook.Sheets[sheetName];
                        var jsonData = XLSX.utils.sheet_to_json(sheet, { header: 1 });

                        console.log("ì—‘ì…€ ë°ì´í„°:", jsonData); // ë””ë²„ê¹…ìš©
                        tableBody.empty();

                        $.each(jsonData.slice(1), function (index, row) {
                            if (row.length < 5) return;
                            var tr = $('<tr>');

                            var ids = ['word', 'pos', 'meaning', 'exampleJp', 'exampleKr']; // ê° tdì˜ id ëª©ë¡
                            $.each(row, function (i, cell) {
                                var td = $('<td>').text(cell);
                                td.attr('id', ids[i] + '-' + index); // ê° tdì— id ì¶”ê°€ (ì¤‘ë³µ ë°©ì§€ë¥¼ ìœ„í•´ index ì¶”ê°€)
                                tr.append(td);
                            });

                            var deleteBtn = $('<button>').text('ğŸ—‘').on('click', function () {
                                tr.remove();
                            });

                            tr.append($('<td>').append(deleteBtn));
                            tableBody.append(tr);
                        });

                        modal.addClass('active');
                    };

                    reader.onerror = function (error) {
                        console.error("íŒŒì¼ ì½ê¸° ì˜¤ë¥˜:", error);
                    };
                }
            });

            $('.btn-submit-deck').on('click', function () {
            	// ì„ì‹œê°’
            	var example = '1';
            	
                var deckName = $('#deckName').val().trim(); // deckName ê°’ ê°€ì ¸ì˜¤ê¸°
                if (!deckName) {
                    deckName = $('#deckName2').val().trim(); // deckNameì´ ë¹„ì–´ìˆìœ¼ë©´ deckName2 ì‚¬ìš©
                }
                var categoryName = $('.categoryName').val();
                var cardDTOList = [];
                var deckDTO = {
                    // categoryId: $('#categoryId').val(),
                    // userId: $('#userId').val(),  // í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ID
                    // ì„ì‹œ ì¹´í…Œê³ ë¦¬ID
                    categoryId: example,
                    deckName: deckName
                };

                $('.card_list tbody tr').each(function () {
                    var row = {
                        word: $(this).find('td[id^="word"]').text(),
                        pos: $(this).find('td[id^="pos"]').text(),
                        meaning: $(this).find('td[id^="meaning"]').text(),
                        exampleJp: $(this).find('td[id^="exampleJp"]').text(),
                        exampleKr: $(this).find('td[id^="exampleKr"]').text()
                    };
                    cardDTOList.push(row);
                });

                console.log(deckDTO);
                console.log(cardDTOList);

                $.ajax({
                    type: "POST",
                    url: "/flashcard/importDeck",
                    contentType: "application/json",
                    data: JSON.stringify({
                        deckDTO: deckDTO,
                        cardDTOList: cardDTOList
                    }),
                    success: function (response) {
                        alert("ë±ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
                        console.log(response);
                    },
                    error: function (xhr, status, error) {
                        console.error("ì˜¤ë¥˜ ë°œìƒ:", error);
                    }
                });
            });
        });
    </script>
    <style>
        .modal_adding_category,
        .modal_editing_category,
        .modal_adding_menu,
        .modal_adding_deck,
        .modal_importing_deck {
            position: absolute;
            display: none;

            justify-content: center;
            top: 0;
            left: 0;

            width: 100%;
            height: 100%;



            background-color: rgba(0, 0, 0, 0.2);
        }

        .adding_category,
        .editing_category,
        .adding_menu,
        .adding_deck,
        .importing_deck {
            position: absolute;
            /* ëª¨ë‹¬ì„ í™”ë©´ê°€ìš´ë° ë†“ê¸°ìœ„í•¨. */
            top: 50%;
            width: 50%;
            height: 50%;
            margin: auto;
            background-color: rgb(255, 255, 255);
            border-radius: 10px;
            box-shadow: 0 2px 3px 0 rgba(34, 36, 38, 0.15);

            /* ëª¨ë“ˆì°½ì—´ì—ˆì„ë•Œ ìœ„ì¹˜ì„¤ì • ê°€ìš´ë°ë¡œ */
            transform: translateY(-50%);


        }

        .modal_header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .card_list {
            background: white;
            padding: 10px;
            min-height: 100px;
            border-radius: 5px;
            overflow-x: auto;
            max-width: 100%;
            white-space: nowrap;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
            position: sticky;
            top: 0;
            z-index: 2;
        }

        #importFile {
            display: none;
        }
    </style>
</head>


<body>
    <button class="btn-open-adding-category-modal">ì¹´í…Œê³ ë¦¬ ì¶”ê°€ Modalì—´ê¸°</button>
    <button class="btn-open-editing-category-modal"> ì¹´í…Œê³ ë¦¬ í¸ì§‘ Modalì—´ê¸°</button>
    <button class="btn-open-adding-menu-modal">í”ŒëŸ¬ìŠ¤ ë²„íŠ¼</button>

    <div class="modal_adding_menu">
        <div class="adding_menu">
            <div><!-- ì¹´í…Œê³ ë¦¬ ìƒì„± ë²„íŠ¼ -->
                <label>ì¹´í…Œê³ ë¦¬
                    <br>
                    <button class="btn-open-adding-category-modal">ì¹´í…Œê³ ë¦¬ ìƒì„±</button>
                </label>
            </div>
            <br>
            <div> <!-- ë± ìƒì„± ë²„íŠ¼ -->
                <p>ë±</p>
                <button class="btn-open-adding-deck-modal">ë± ìƒì„±</button>
                <button class="btn-open-importing-deck-modal">ë± ë¶ˆëŸ¬ì˜¤ê¸°</button>
                <input id="importFile" type="file" />
            </div>
            <div>
                <button type="button" class="btn-close-modal">ë‹«ê¸°</button>
            </div>
        </div>
    </div>

    <div class="modal_adding_category">
        <div class="adding_category">
            <form th:action="@{/flashcard/insertCategory}" action="/flashcard/insertCategory" method="GET">

                <h2>ì¹´í…Œê³ ë¦¬ ì¶”ê°€</h2>
                <label>ì¹´í…Œê³ ë¦¬ :
                    <input type="text" name="categoryName" id="categoryName" placeholder="ì¹´í…Œê³ ë¦¬ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”">
                </label><br>
                <button type="submit">ì¶”ê°€</button>
                <button type="button" class="btn-close-modal">ë‹«ê¸°</button>
            </form>
        </div>
    </div>


    <div class="modal_editing_category">
        <div class="editing_category">
            <form th:action="@{/flashcard/updateCategory}" action="/flashcard/updateCategory" method="GET">
                <h2>ì¹´í…Œê³ ë¦¬ í¸ì§‘</h2>
                <!-- htmlì„ ì²˜ìŒ ë¶ˆëŸ¬ì˜¤ë©´ì„œ ëª¨ë¸ë¡œ categoryIdë¥¼ ë¶ˆëŸ¬ì™€ì•¼ í•¨ type="hidden" -->
                <input type="text" name="categoryId" id="categoryId" value="1">
                <label>ì¹´í…Œê³ ë¦¬ :
                    <input type="text" name="categoryName" id="categoryName" placeholder="ì…ë ¥ëœ ì¹´í…Œê³ ë¦¬ëª…">
                </label><br>
                <button type="submit">ìˆ˜ì •</button>
                <button type="button" class="btn-close-modal">ë‹«ê¸°</button>
            </form>
        </div>
    </div>

    <div class="modal_adding_deck">
        <div class="adding_deck">
            <form th:action="@{/flashcard/insertDeck}" action="/flashcard/insertDeck" method="GET">

                <label>ë±ì´ë¦„ :
                    <input type="text" name="deckName" id="deckName" placeholder="ë± ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”">
                </label>
                <label>ì¹´í…Œê³ ë¦¬ :
                    <select name="categoryName" id="categoryName">
                        <option value="1">ì„ì‹œ1</option>
                        <option value="2">ì„ì‹œ2</option>
                    </select>
                </label>
                <div>
                    <table class="card_list">
                        <thead>
                            <tr>
                                <th>ë‹¨ì–´</th>
                                <th>í’ˆì‚¬</th>
                                <th>ëœ»</th>
                                <th>ì˜ˆë¬¸</th>
                                <th>ì˜ˆë¬¸ ëœ»</th>
                                <th>ì‚­ì œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>ë‹¨ì–´</td>
                                <td>í’ˆì‚¬</td>
                                <td>ëœ»</td>
                                <td>ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸</td>
                                <td>ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸</td>
                                <td><button>ğŸ—‘</button></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <button class="btn-open-adding-card-modal">ì¹´ë“œ ì¶”ê°€</button>
                <br>
                <div>
                    <!-- <button type="submit">ì¶”ê°€</button> -->
                    <button type="button" class="btn-submit-deck">ì €ì¥2</button>
                    <button type="button" class="btn-close-modal">ë‹«ê¸°</button>
                </div>
            </form>
        </div>
    </div>

    <div class="modal_importing_deck">
        <div class="importing_deck">
            <form th:action="@{/flashcard/importDeck}" action="/flashcard/importDeck" method="POST">
                <label>ë±ì´ë¦„ :
                    <input type="text" name="deckName2" id="deckName2" placeholder="ë± ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”">
                </label>
                <label>ì¹´í…Œê³ ë¦¬ :
                    <select name="categoryName" class="categoryName">
                        <option value="1">ì„ì‹œ1</option>
                        <option value="2">ì„ì‹œ2</option>
                    </select>
                </label>
                <div class="card_list">
                    <table>
                        <thead>
                            <tr>
                                <th>ë‹¨ì–´</th>
                                <th>í’ˆì‚¬</th>
                                <th>ëœ»</th>
                                <th>ì˜ˆë¬¸</th>
                                <th>ì˜ˆë¬¸ ëœ»</th>
                                <th>ì‚­ì œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>ë‹¨ì–´</td>
                                <td>í’ˆì‚¬</td>
                                <td>ëœ»</td>
                                <td>ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸</td>
                                <td>ì˜ˆë¬¸ëœ»ëœ»ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸ì˜ˆë¬¸</td>
                                <td><button>ğŸ—‘</button></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <button class="btn-open-adding-card-modal">ì¹´ë“œ ì¶”ê°€</button>
                <br>
                <div>
                    <!-- <button type="submit">ì¶”ê°€</button> -->
                    <button type="button" class="btn-submit-deck">ì €ì¥</button>
                    <button type="button" class="btn-close-modal">ë‹«ê¸°</button>
                </div>
            </form>
        </div>
    </div>


</body>


</html>